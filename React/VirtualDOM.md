# 虚拟元素

`VirtualDOM`是一种虚拟的元素, 在发生改变时会映射到真实`DOM`中;

## `diff`算法

`VirtualDOM`使用`diff`算法计算两次更新的差异, 最终将差异的部分更新到真实`DOM`上.
`diff`算法检查到元素改变时会删除旧的节点, 并不关心这个节点会不会被其他地方引用.
所以`diff`需要进行比对的工作量大幅度减少(从`O(n^3)`降低到`O(n)`),但是元素移动时又会删除重新创建元素;
采用这种`diff`算法是基于两个条件:

1. 组件的`DOM`结构相对稳定, 改变比较少;
2. 类型相同的兄弟节点可以被唯一标识, 根据列表的`KEY`进行元素移动;

### 广度优先分层比较

拿到更新前后两个`DOM`树之后会一层一层进行比较, 从根节点开始向下逐层比较.

+ 元素顺序发生改变时会根据元素的唯一标识`key`来改变元素的顺序;
+ 子元素改变时会删除旧的元素, 然后创建新的添加进父元素;
+ 节点的父元素改变时,会删除原来的节点然后再创建一个新的;
